// ==UserScript==
// @name Safe Writing
// @name:pt Escrita segura
// @name:es Escritura segura
// @name:it Scrittura sicura
// @namespace https://gitea.com/thisago/gm_api
// @description Write in websites without being tracked every keystroke
// @version 0.3.0
// @author Thiago Navarro
// @homepageURL https://github.com/thisago/safeWriting
// @match *://*/*
// @grant GM.getValue
// @grant GM.setValue
// @grant GM.registerMenuCommand
// @run-at document-idle
// @downloadURL https://raw.githubusercontent.com/thisago/safeWriting/master/build/safeWriting.user.js
// ==/UserScript==
// Metadata automatically generated with https://gitea.com/thisago/gm_api
var framePtr=null;var excHandler=0;var lastJSError=null;var NTI33554439={size:0,kind:28,base:null,node:null,finalizer:null};function mnewString(len_33556889){return new Array(len_33556889)}function setConstr(){var result={};for(var i=0;i<arguments.length;++i){var x=arguments[i];if(typeof x=="object"){for(var j=x[0];j<=x[1];++j){result[j]=true}}else{result[x]=true}}return result}var ConstSet1=setConstr(17,16,4,18,27,19,23,22,21);function nimCopy(dest_33557136,src_33557137,ti_33557138){var result_33557147=null;switch(ti_33557138.kind){case 21:case 22:case 23:case 5:if(!isFatPointer_33557127(ti_33557138)){result_33557147=src_33557137}else{result_33557147=[src_33557137[0],src_33557137[1]]}break;case 19:if(dest_33557136===null||dest_33557136===undefined){dest_33557136={}}else{for(var key in dest_33557136){delete dest_33557136[key]}}for(var key in src_33557137){dest_33557136[key]=src_33557137[key]}result_33557147=dest_33557136;break;case 18:case 17:if(!(ti_33557138.base==null)){result_33557147=nimCopy(dest_33557136,src_33557137,ti_33557138.base)}else{if(ti_33557138.kind==17){result_33557147=dest_33557136===null||dest_33557136===undefined?{m_type:ti_33557138}:dest_33557136}else{result_33557147=dest_33557136===null||dest_33557136===undefined?{}:dest_33557136}}nimCopyAux(result_33557147,src_33557137,ti_33557138.node);break;case 24:case 4:case 27:case 16:if(src_33557137===null){result_33557147=null}else{if(dest_33557136===null||dest_33557136===undefined){dest_33557136=new Array(src_33557137.length)}else{dest_33557136.length=src_33557137.length}result_33557147=dest_33557136;for(var i=0;i<src_33557137.length;++i){result_33557147[i]=nimCopy(result_33557147[i],src_33557137[i],ti_33557138.base)}}break;case 28:if(src_33557137!==null){result_33557147=src_33557137.slice(0)}break;default:result_33557147=src_33557137;break}return result_33557147}function makeNimstrLit(c_33556797){var result=[];for(var i=0;i<c_33556797.length;++i){result[i]=c_33556797.charCodeAt(i)}return result}var inputElements_1124073482=[makeNimstrLit("input:not([type=button]):not([type=checkbox]):not([type=file]):not([type=hidden]):not([type=image]):not([type=radio]):not([type=reset]):not([type=submit])"),makeNimstrLit("textarea"),makeNimstrLit("[contenteditable=true]")];function toJSStr(s_33556803){var Temporary5;var Temporary7;var result_33556804=null;var res_33556838=newSeq_33556821(s_33556803.length);var i_33556839=0;var j_33556840=0;Label1:do{Label2:while(true){if(!(i_33556839<s_33556803.length))break Label2;var c_33556841=s_33556803[i_33556839];if(c_33556841<128){res_33556838[j_33556840]=String.fromCharCode(c_33556841);i_33556839+=1}else{var helper_33556853=newSeq_33556821(0);Label3:do{Label4:while(true){if(!true)break Label4;var code_33556854=c_33556841.toString(16);if((code_33556854==null?0:code_33556854.length)==1){helper_33556853.push("%0")}else{helper_33556853.push("%")}helper_33556853.push(code_33556854);i_33556839+=1;if(s_33556803.length<=i_33556839)Temporary5=true;else{Temporary5=s_33556803[i_33556839]<128}if(Temporary5){break Label3}c_33556841=s_33556803[i_33556839]}}while(false);++excHandler;Temporary7=framePtr;try{res_33556838[j_33556840]=decodeURIComponent(helper_33556853.join(""));--excHandler}catch(EXCEPTION){var prevJSError=lastJSError;lastJSError=EXCEPTION;--excHandler;framePtr=Temporary7;res_33556838[j_33556840]=helper_33556853.join("");lastJSError=prevJSError}finally{framePtr=Temporary7}}j_33556840+=1}}while(false);if(res_33556838.length<j_33556840){for(var i=res_33556838.length;i<j_33556840;++i)res_33556838.push(null)}else{res_33556838.length=j_33556840}result_33556804=res_33556838.join("");return result_33556804}var inputTriggerEvents_1124073483=[makeNimstrLit("dblclick")];if(!Math.trunc){Math.trunc=function(v){v=+v;if(!isFinite(v))return v;return v-v%1||(v<0?-0:v===0?v:0)}}var objectID_637534370=[0];function isFatPointer_33557127(ti_33557128){var result_33557129=false;BeforeRet:do{result_33557129=!(ConstSet1[ti_33557128.base.kind]!=undefined);break BeforeRet}while(false);return result_33557129}function nimCopyAux(dest_33557140,src_33557141,n_33557142){switch(n_33557142.kind){case 0:break;case 1:dest_33557140[n_33557142.offset]=nimCopy(dest_33557140[n_33557142.offset],src_33557141[n_33557142.offset],n_33557142.typ);break;case 2:for(var i=0;i<n_33557142.sons.length;i++){nimCopyAux(dest_33557140,src_33557141,n_33557142.sons[i])}break;case 3:dest_33557140[n_33557142.offset]=nimCopy(dest_33557140[n_33557142.offset],src_33557141[n_33557142.offset],n_33557142.typ);for(var i=0;i<n_33557142.sons.length;++i){nimCopyAux(dest_33557140,src_33557141,n_33557142.sons[i][1])}break}}function nsuJoinSep(a_872416596,sep_872416597){var result_872416598=[];if(0<a_872416596.length){var L_872416605=sep_872416597.length*(a_872416596.length-1);Label1:do{var i_872416613=0;var colontmp__1124073475=0;colontmp__1124073475=a_872416596.length-1;var res_1124073476=0;Label2:do{Label3:while(true){if(!(res_1124073476<=colontmp__1124073475))break Label3;i_872416613=res_1124073476;L_872416605+=a_872416596[i_872416613].length;res_1124073476+=1}}while(false)}while(false);result_872416598=nimCopy(null,mnewString(0),NTI33554439);result_872416598.push.apply(result_872416598,a_872416596[0]);Label4:do{var i_872416625=0;var colontmp__1124073479=0;colontmp__1124073479=a_872416596.length-1;var res_1124073480=1;Label5:do{Label6:while(true){if(!(res_1124073480<=colontmp__1124073479))break Label6;i_872416625=res_1124073480;result_872416598.push.apply(result_872416598,sep_872416597);result_872416598.push.apply(result_872416598,a_872416596[i_872416625]);res_1124073480+=1}}while(false)}while(false)}else{result_872416598=nimCopy(null,[],NTI33554439)}return result_872416598}function newSeq_33556821(len_33556823){var result_33556824=[];result_33556824=new Array(len_33556823);for(var i=0;i<len_33556823;++i){result_33556824[i]=null}return result_33556824}function add_33556420(x_33556421,x_33556421_Idx,y_33556422){if(x_33556421[x_33556421_Idx]===null){x_33556421[x_33556421_Idx]=[]}var off=x_33556421[x_33556421_Idx].length;x_33556421[x_33556421_Idx].length+=y_33556422.length;for(var i=0;i<y_33556422.length;++i){x_33556421[x_33556421_Idx][off+i]=y_33556422.charCodeAt(i)}}async function main_469762065(){async function handleInput_469762084(ev_469762085){var result_469762087=null;BeforeRet:do{if(ev_469762085.isTrusted){var el_469762093=ev_469762085.target;var text_469762094=window.prompt(el_469762093.getAttribute("placeholder"),el_469762093.value);if(!(text_469762094===null)){Label1:do{if(historyEnabled_469762077){if(text_469762094==historyCommand_469762082){el_469762093.value=await GM.getValue("history_value","");break Label1}await GM.setValue("history_value",text_469762094)}el_469762093.value=text_469762094}while(false)}}result_469762087=undefined;break BeforeRet}while(false);return result_469762087}var Temporary7;function HEX3Aanonymous_469762196(){var Temporary1;if(historyEnabled_469762077){Temporary1=makeNimstrLit("0")}else{Temporary1=makeNimstrLit("1")}var _=GM.setValue("history_enabled",toJSStr(Temporary1));window.alert("Success! Please reload the page")}function HEX3Aanonymous_469762208(){var Temporary1;var text_469762209=window.prompt("History command","");if(!!(text_469762209===null))Temporary1=false;else{Temporary1=!(text_469762209=="")}if(Temporary1){var _=GM.setValue("history_command",text_469762209);window.alert("Command successfully changed. Reload the page to use")}}function HEX3Aanonymous_469762219(){var _=GM.setValue("history_value","");window.alert("Successfully cleaned!")}var result_469762067=null;BeforeRet:do{var historyEnabled_469762077=await GM.getValue("history_enabled","1")=="1";var historyCommand_469762082=await GM.getValue("history_command","@");Label1:do{var el_469762154=null;var el_469762154_Idx=0;var colontmp__469762273=[];colontmp__469762273=document.querySelectorAll(toJSStr(nsuJoinSep(inputElements_1124073482,makeNimstrLit(","))));var i_469762275=0;var L_469762276=colontmp__469762273.length;Label2:do{Label3:while(true){if(!(i_469762275<L_469762276))break Label3;el_469762154=colontmp__469762273;el_469762154_Idx=i_469762275;Label4:do{var event_469762189=[];var i_469762271=0;Label5:do{Label6:while(true){if(!true)break Label6;event_469762189=inputTriggerEvents_1124073483[i_469762271];el_469762154[el_469762154_Idx].addEventListener(toJSStr(event_469762189),handleInput_469762084);if(0<=i_469762271){break Label5}i_469762271+=1}}while(false)}while(false);i_469762275+=1}}while(false)}while(false);if(historyEnabled_469762077){Temporary7=makeNimstrLit("Disable")}else{Temporary7=makeNimstrLit("Enable")}GM.registerMenuCommand(toJSStr((Temporary7||[]).concat(makeNimstrLit(" History")||[])),HEX3Aanonymous_469762196,"h");var fmtRes_469762207=[mnewString(0)];fmtRes_469762207[0].push.apply(fmtRes_469762207[0],makeNimstrLit("Change history command ("));add_33556420(fmtRes_469762207,0,historyCommand_469762082);fmtRes_469762207[0].push.apply(fmtRes_469762207[0],makeNimstrLit(")"));GM.registerMenuCommand(toJSStr(fmtRes_469762207[0]),HEX3Aanonymous_469762208,"c");GM.registerMenuCommand("Clean saved history",HEX3Aanonymous_469762219,"c");result_469762067=undefined;break BeforeRet}while(false);return result_469762067}var _=main_469762065();